<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản trị</title>
    <link rel="stylesheet" href="./assets/css/QuảnTrị.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/fonts/themify-icons-font/themify-icons/themify-icons.css">
</head>
<body>
    <div class="wrap">
        <div class="left">
            <div style=" margin-top: 15px;border-bottom: 1px solid #4b545c;width: 100%;text-align: center;padding-bottom: 20px;"><a href="">Admin HUGU</a></div>
            <div style="text-align: center;margin-top: 20px;display: flex;border-bottom: 1px solid #4b545c;width: 100%;padding-bottom: 20px;">
                <img  style="border-radius: 50%;width: 40px;height: 40px;margin-right: 15px;margin-left: 15px;" src="./assets/img/Độ Mixi.jpg" alt="">
                <div style="margin-top: 10px;"><a style="font-size: 16px;" href="">Nguyễn Quốc Việt</a></div>
            </div>
            <div style="font-size: 20px;color: #d4d5d5;margin:20px 0 0 10px;font-weight: 500;">GENERAL</div>
           <div class="main">
            <ul class="main-1">
                <li ><a href=""><i class="ti-home"></i> <span>Home <i style="margin-left: 85px;" class="ti-angle-down"></i> </span> </a>
                    <ul class="down">
                        <li ><a href=""><i class="ti-basketball"></i>Tìm kiếm</a></li>
                        <li ><a href=""><i class="ti-basketball"></i>Quản lý</a></li>
                        <li ><a href=""><i class="ti-basketball"></i>Thống kê</a></li>
                    </ul>

                </li>

                <li ><a href=""><i class="ti-pencil-alt"></i> <span>Quản lý <i style="margin-left: 70px;" class="ti-angle-down"></i> </span> </a>
                    <ul class="down">
                        <li ><a href="KháchHang.html"><i class="ti-rocket"></i>Khách hàng</a></li>
                        <li ><a href=""><i class="ti-rocket"></i>Nhân viên</a></li>
                        <li ><a href=""><i class="ti-rocket"></i>Hàng</a></li>
                        <li ><a href=""><i class="ti-rocket"></i>Hóa đơn</a></li>
                    </ul>

                </li>

                <li ><a href=""><i class="ti-bar-chart-alt"></i> <span>Báo cáo <i style="margin-left: 65px;" class="ti-angle-down"></i> </span> </a>
                    <ul class="down">
                        <li ><a href=""><i class="ti-anchor"></i>Doanh thu tuần</a></li>
                        <li ><a href=""><i class="ti-anchor"></i>Doanh thu quý</a></li>
                        <li ><a href=""><i class="ti-anchor"></i>Doanh thu năm</a></li>
                    </ul>

                </li>

                <li ><a href=""><i class="ti-user"></i> <span>Tài khoản <i style="margin-left: 52px;" class="ti-angle-down"></i> </span> </a>
                    <ul class="down">
                        <li ><a href=""><i class="ti-face-sad"></i>Đổi mật khẩu</a></li>
                        <li ><a href=""><i class="ti-face-sad"></i>Đăng xuất</a></li>
                        
                    </ul>

                </li>
            </ul>
           </div>
        </div>

        <div class="right">
            <div class="first">
                <!-- <a  href="URL-cua-trang-menu.html"><i class="ti-menu"></i></a> -->
                <a href="">Manage</a>
                <a href="">Contact</a>
                <div style="float: right;">
                    <!-- <a href=""><i class="ti-shine"></i></a>
                    <a href=""><i class="ti-search"></i></a>
                    <a href=""><i class="ti-email"></i></a>
                    <a href=""><i class="ti-bell"></i></a> -->
                   
<a href="URL-cua-trang-shine.html" title="Trang Shine"><i class="ti-shine"></i> Shine</a>
<a href="URL-cua-trang-search.html" title="Trang Tìm kiếm"><i class="ti-search"></i> Tìm kiếm</a>
<a href="URL-cua-trang-email.html" title="Trang Email"><i class="ti-email"></i> Email</a>

                    <a href=""><img style="border-radius: 50%;width: 20px;height: 20px;" src="./assets/img/Độ Mixi.jpg" alt="">
                    </a>
                </div>
            </div>

            <table id="khach-hang-table">
               <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã sản phẩm</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng tồn</th>
                    <th>Sửa</th>
                    <th>Xóa</th>
                </tr>
               </thead>

                <tbody>

                    
                   <!-- <tr>
                        <td>1</td>
                        <td>001</td>
                        <td>I WANT IT</td>
                        <td>85</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>002</td>
                        <td>THE BLUR</td>
                        <td>100</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>003</td>
                        <td>NOT BAD</td>
                        <td>68</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>4</td>
                        <td>004</td>
                        <td>HUGU MEOW GANG</td>
                        <td>46</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>5</td>
                        <td>005</td>
                        <td>LOOK INTO MY EYES</td>
                        <td>19</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>6</td>
                        <td>006</td>
                        <td>CROP BLAZER</td>
                        <td>05</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>7</td>
                        <td>007</td>
                        <td>MOU BLUE JACKET</td>
                        <td>26</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>8</td>
                        <td>008</td>
                        <td>REFLECTIVE GREY</td>
                        <td>90</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr>

                    <tr>
                        <td>9</td>
                        <td>009</td>
                        <td>HARAHI GREEN JEAN</td>
                        <td>37</td>
                        <td class="td"><i class="ti-reload"></i></td>
                        <td class="td"><i class="ti-trash"></i></td>
                    </tr> -->

                   
                </tbody> 

                <tfoot></tfoot>
            </table>

           
            <form id="create-khach-form" style="margin-left: 500px;">
                <input type="text" id="maKH" placeholder="Mã khách hàng">
                <input type="text" id="tenKH" placeholder="Tên khách hàng">
                <input type="text" id="diaChi" placeholder="Địa chỉ">
                <input type="text" id="sdt" placeholder="Số điện thoại">
               
                <button type="submit">Thêm Khách Hàng</button>
            </form>

            <h3>Chỉnh sửa thông tin khách hàng</h3>
        <form id="edit-customer-form">
            <input type="text" id="edit-maKH" value="${maKH}" disabled>
            <input type="text" id="edit-tenKH" value="${tenKH}">
            <input type="text" id="edit-diaChi" value="${diaChi}">
            <input type="text" id="edit-sdt" value="${sdt}">
            <button type="submit">Lưu</button>
        </form>

        <form id="search-form">
            <input type="text" id="ten_khach" placeholder="Tên khách hàng">
            <input type="text" id="dia_chi" placeholder="Địa chỉ">
            <button type="submit">Tìm kiếm</button>
        </form>

        <div id="search-results">
            <!-- Nơi hiển thị kết quả tìm kiếm từ API -->
        </div>

        <div id="notification" style="display: none;"></div>

        
        
        </div>
    </div>


   
    


<script>
   //Get-all
  document.addEventListener("DOMContentLoaded", function () {
    // Gọi API và xử lý dữ liệu
    fetch("https://localhost:7172/api/Khach/get_all")
        .then(function (response) {
            return response.json();
        })
        .then(function (data) {
            // Lấy thẻ tbody của bảng
            var tbody = document.getElementById("khach-hang-table").getElementsByTagName('tbody')[0];

            // Xử lý dữ liệu và thêm vào bảng
            data.forEach(function (khachHang) {
                var row = tbody.insertRow();
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3); 
                var editCell = row.insertCell(4);
                var deleteCell = row.insertCell(5);

                cell1.innerHTML = khachHang.maKH;
                cell2.innerHTML = khachHang.tenKH;
                cell3.innerHTML = khachHang.diaChi;
                cell4.innerHTML = khachHang.sdt; // Đổi tên biến ở đây

                 // Cập nhật nội dung cho cột Sửa (Edit) và Xóa (Delete)
                 editCell.innerHTML = '<a href="javascript:void(0)" class="edit-link">Sửa</a>';
                deleteCell.innerHTML = '<a href="javascript:void(0)" class="delete-link">Xóa</a>';















                // Gắn sự kiện "click" vào từng liên kết "Sửa"
                //Sửa
var editLinks = document.querySelectorAll(".edit-link");

editLinks.forEach(function (editLink) {
    editLink.addEventListener("click", function () {
        var row = this.closest("tr");

        var maKH = row.querySelector("td:nth-child(1)").innerText;
        var tenKH = row.querySelector("td:nth-child(2)").innerText;
        var diaChi = row.querySelector("td:nth-child(3)").innerText;
        var sdt = row.querySelector("td:nth-child(4)").innerText;

        // Hiển thị thông tin trong biểu mẫu chỉnh sửa
        document.getElementById("edit-maKH").value = maKH;
        document.getElementById("edit-tenKH").value = tenKH;
        document.getElementById("edit-diaChi").value = diaChi;
        document.getElementById("edit-sdt").value = sdt;

        // Gắn sự kiện "submit" cho biểu mẫu chỉnh sửa
        document.getElementById("edit-customer-form").addEventListener("submit", function (event) {
            event.preventDefault();

            // Lấy giá trị sau khi chỉnh sửa
            var editedMaKH = document.getElementById("edit-maKH").value;
            var editedTenKH = document.getElementById("edit-tenKH").value;
            var editedDiaChi = document.getElementById("edit-diaChi").value;
            var editedSdt = document.getElementById("edit-sdt").value;

            // Tạo đối tượng chứa dữ liệu chỉnh sửa
            var updatedKhachHangData = {
                maKH: editedMaKH,
                tenKH: editedTenKH,
                diaChi: editedDiaChi,
                sdt: editedSdt
            };

            // Gửi yêu cầu cập nhật đến API
            fetch("https://localhost:7172/api/Khach/Update", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(updatedKhachHangData)
            })
            .then(function (response) {
                if (response.ok) {
                    // Sau khi cập nhật thành công, bạn có thể cập nhật giao diện ngay lập tức hoặc hiển thị thông báo thành công.
                    console.log("Khách hàng đã được cập nhật thành công!");
                    showNotification("Thông tin của khách hàng đã được cập nhật!", "success");
                } else {
                    console.error("Lỗi khi cập nhật khách hàng");
                    showNotification("Cập nhật không thành công", "error");
                }
            })
            .catch(function (error) {
                console.error("Lỗi khi gửi yêu cầu cập nhật khách hàng:", error);
            });
        });
    });
});






                
        













//Xóa
                var deleteLinks = document.querySelectorAll(".delete-link");

                    // Lặp qua mảng các liên kết "Xóa" và gán sự kiện click cho từng liên kết
                    deleteLinks.forEach(function (deleteLink) {
                        deleteLink.addEventListener("click", function () {
                            // Xác định hàng mà liên kết "Xóa" được nhấn
                            var row = this.closest("tr");

                            // Lấy mã khách hàng từ cột thứ hai của hàng đó
                            var maKH = row.querySelector("td:nth-child(1)").innerText;

                            // Gửi yêu cầu DELETE đến API để xóa khách hàng
                            fetch(`https://localhost:7172/api/Khach/Delete?id=${maKH}`, {
                                     method: "POST"
                                    })

                            .then(function (response) {
                                if (response.ok) {
                                    row.remove();
                                    showNotification("Đã xóa thành công!", "success");
                                } else {
                                    console.error("Lỗi khi xóa khách hàng");
                                    showNotification("Không xóa được", "error");
                                }
                            })
                            .catch(function (error) {
                                console.error("Lỗi khi gửi yêu cầu xóa khách hàng:", error);
                            });
                        });
                    });
                });
            });
        })


       
        


    






//Thêm
    const form = document.getElementById("create-khach-form");

    form.addEventListener("submit", function (event) {
        event.preventDefault();

        // Lấy giá trị từ biểu mẫu
        const maKH = document.getElementById("maKH").value;
        const tenKH = document.getElementById("tenKH").value;
        const diaChi = document.getElementById("diaChi").value;
        const sdt = document.getElementById("sdt").value;


        // Tạo đối tượng chứa dữ liệu
        const khachHangData = {
            maKH: maKH,
            tenKH: tenKH,
            diaChi: diaChi,
            sdt: sdt, 
        };

        // Gửi dữ liệu lên API để tạo khách hàng mới
        fetch("https://localhost:7172/api/Khach/Create", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(khachHangData)
        })
        .then(function (response) {
            if (response.ok) {
                return response.json();
            }
            throw new Error("Lỗi khi thêm khách hàng");
        })
        .then(function (data) {
            // Xử lý dữ liệu từ phản hồi API (nếu cần)
            console.log("Khách hàng đã được thêm thành công:", data);
            showNotification("Khách hàng đã được thêm thành công!", "success");

            // Sau khi thêm thành công, bạn có thể làm gì đó, ví dụ: cập nhật bảng hoặc hiển thị thông báo
        })
        .catch(function (error) {
            console.error("Lỗi khi thêm khách hàng:", error);
            showNotification("Không thêm được", "error");
        });
    });







const searchForm = document.getElementById("search-form");
const searchResults = document.getElementById("search-results");
const resultTable = document.createElement("table"); 

searchForm.addEventListener("submit", function (event) {
    event.preventDefault();

    const ten_khach = document.getElementById("ten_khach").value;
    const dia_chi = document.getElementById("dia_chi").value;
    const pageSize = 5;

    const formData = {
        page: 1,
        pageSize: pageSize,
        ten_khach: ten_khach,
        dia_chi: dia_chi
    };

   
    while (resultTable.firstChild) {
        resultTable.removeChild(resultTable.firstChild);
    }

    fetch("https://localhost:7172/api/Khach/search", {
        method: "POST",
        body: JSON.stringify(formData),
        headers: {
            "Content-Type": "application/json"
        }
    })
    .then(function (response) {
        return response.json();
    })
    .then(function (data) {
        if (Array.isArray(data.data) & data.data.lenght > 0) {
           
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

           
            const headerRow = thead.insertRow();
            for (let key in data.data[0]) {
                const th = document.createElement("th");
                th.textContent = key;
                headerRow.appendChild(th);
            }

            data.data.forEach(function (item) {
                const row = tbody.insertRow();
                for (let key in item) {
                    const cell = row.insertCell();
                    cell.textContent = item[key];
                }
            });

            resultTable.appendChild(thead);
            resultTable.appendChild(tbody);

           
            searchResults.appendChild(resultTable);
            console.log(data);
            showNotification("Kết quả tìm kiếm đã được hiển thị!", "success");
        } else {
           
            showNotification("Không tìm thấy kết quả phù hợp.", "error");
            console.error("Dữ liệu trả về không phải một mảng:", data.data);
        }
    })
    .catch(function (error) {
        showNotification("Có lỗi xảy ra khi tìm kiếm.", "error");
        console.error("Lỗi khi tìm kiếm:", error);
    });
});





function showNotification(message, type) {
    const notification = document.getElementById("notification");
    notification.textContent = message;
    notification.style.display = "block";

    if (type === "success") {
        notification.style.backgroundColor = "green";
        notification.style.color = "white";
    } else if (type === "error") {
        notification.style.backgroundColor = "red";
        notification.style.color = "white";
    }

    setTimeout(function () {
        notification.style.display = "none";
    }, 3000); // 3 giây
} 



















</script>








</body>
</html>










